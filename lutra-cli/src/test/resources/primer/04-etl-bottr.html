<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-03-09 Mon 11:37 -->
<meta  charset="utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>pOTTR: Extract, transform and Load with bOTTR</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="root" />
<link rel="stylesheet" type="text/css" href="https://www.ottr.xyz/inc/spec.css" />
<script type="application/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="application/javascript" src="https://www.ottr.xyz/inc/toc.js"></script>
<link rel="stylesheet" type="text/css" href="https://weblutra.ottr.xyz/js/weblutrabox.css" />
<script type="application/javascript" src="https://weblutra.ottr.xyz/js/weblutrabox.js"></script>
<link rel="stylesheet" type="text/css" href="./inc/pottr.css" />
<script type="application/javascript" src="./inc/pottr.js"></script>
</head>
<body>
<div id="content">
<header>
<h1 class="title">pOTTR: Extract, transform and Load with bOTTR</h1>
</header><div id="left">
<p>
<a href="#top">top</a>
</p>
<h4>Table of Contents</h4>
<div id="toc"></div>
</div>

<div id="right">

<h1 id="top" class="title">Extract, transform and Load with bOTTR</h1>
<img id="logo" alt="pOTTR" src="http://www.ottr.xyz/logo/pOTTR.png"/>
<p>
<b>Convert queryable sources to OTTR template instances</b>
</p>

<dl class="org-dl">
<dt>Authors</dt><dd>Martin G. Skj√¶veland</dd>
<dt>Issues</dt><dd><a href="https://gitlab.com/ottr/language/pOTTR/issues">https://gitlab.com/ottr/language/pOTTR/issues</a></dd>
</dl>

<div id="toc-content">

<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This chapter contains exercises that show how bOTTR [<a href="#orgtarget1">1</a>] can be
used to extract data by quering RDF files, SPARQL endpoints, CSV
files and relational database and converting the query results to
OTTR template instances.
</p>
</div>

<div id="outline-container-orgheadline1" class="outline-3">
<h3 id="prefixes"><a id="orgheadline1"></a><span class="section-number-3">1.1</span> Prefixes</h3>
<div class="outline-text-3" id="text-prefixes">
<p>
The following prefixes are used throughout the document, and may be
used in the text input areas of the interactive examples without
declaration.
</p>

<div class="org-src-container">

<pre class="src src-ttl" id="orgsrcblock1">@prefix rdf:    &lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#&gt; . 
@prefix rdfs:   &lt;http://www.w3.org/2000/01/rdf-schema#&gt; . 
@prefix owl:    &lt;http://www.w3.org/2002/07/owl#&gt; . 
@prefix xsd:    &lt;http://www.w3.org/2001/XMLSchema#&gt; . 
@prefix foaf:   &lt;http://xmlns.com/foaf/0.1/&gt; . 
@prefix dbp:    &lt;http://dbpedia.org/ontology/&gt; . 
@prefix ex:     &lt;http://example.com/ns#&gt; . 
@prefix ottr:   &lt;http://ns.ottr.xyz/0.4/&gt; . 
@prefix ax:     &lt;http://tpl.ottr.xyz/owl/axiom/0.1/&gt; . 
@prefix rstr:   &lt;http://tpl.ottr.xyz/owl/restriction/0.1/&gt; .
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline7" class="outline-2">
<h2 id="orgheadline7"><span class="section-number-2">2</span> Extracting data from RDF files and SPARQL endpoints</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3"><span class="section-number-3">2.1</span> Exercise: Copying triples from SPARQL endpoints</h3>
<div class="outline-text-3" id="text-2-1">
<p>
The bOTTR map below retrieves 5 triples the SPARQL endpoint at
<a href="http://dbpedia.org/sparql">http://dbpedia.org/sparql</a> and instantiates the base template
<code>ottr:Triple</code>.
</p>

<p>
Change the <code>ottr:InstanceMap</code> so that it instead selects 5 type
relationships, i.e., triples with a <code>rdf:type</code> predicate, and
instantiates the <code>ex:Type</code> template found below.
</p>

<div class="weblutra">
<input type="hidden" class="reset-value" data-name="inputFormat" value="bottr"/>
<div class="input">
<p>
<textarea cols="80" rows="10">
[] a ottr:InstanceMap ;
    ottr:template ottr:Triple ;
    ottr:query """
	SELECT ?s ?p ?o 
	WHERE { ?s ?p ?o } 
	LIMIT 5
    """ ;
    ottr:source
	[ a ottr:SPARQLEndpointSource ;
	  ottr:sourceURL "http://dbpedia.org/sparql" ] .
</textarea>
</p>

</div>

<div class="library">
<p>
<textarea cols="80" rows="3">
ex:Type[ottr:IRI ?individual, ottr:IRI ?type] :: {
  ottr:Triple(?individual, rdf:type, ?type)
} .
</textarea>
</p>

</div>

</div>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4"><span class="section-number-3">2.2</span> Exercise: Collecting properties from RDF, RDFS and OWL</h3>
<div class="outline-text-3" id="text-2-2">
<p>
The following map collects 15 triples from the vocabulary
specifications of the RDF standards using <code>ottr:RDFFileSource</code> as
source.
</p>

<ol class="org-ol">
<li>Change the map so that it uses the <code>ex:Type</code> template and
outputs all the all properties that are defined in the RDF and
RDFS standards. The RDFS vocabulary is found at its IRI
<code>http://www.w3.org/2000/01/rdf-schema</code>.</li>

<li>Add an additional <code>ottr:InstanceMap</code> that is based on the map
from 1., but which collects all the classes from the RDF, RDFS
and OWL vocabularies. The OWL vocabulary can be found at
<code>http://www.w3.org/2002/07/owl</code>.</li>
</ol>

<div class="weblutra">
<input type="hidden" class="reset-value" data-name="inputFormat" value="bottr"/>
<div class="input">
<p>
<textarea cols="80" rows="12">
[] a ottr:InstanceMap ;
    ottr:template ottr:Triple ;
    ottr:query """
	SELECT ?s ?p ?o  
	{ ?s ?p ?o }
	LIMIT 15
    """ ;
    ottr:source
	[ a ottr:RDFFileSource ;
	  ottr:sourceURL 
	    "http://www.w3.org/2000/01/rdf-schema"
	] .
</textarea>
</p>

</div>

<div class="library">
<p>
<textarea cols="80" rows="3">
ex:Type[ottr:IRI ?individual, ottr:IRI ?type] :: {
  ottr:Triple(?individual, rdf:type, ?type)
} .
</textarea>
</p>

</div>

</div>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5"><span class="section-number-3">2.3</span> Exercise: Instantiating Person with data from dbpedia</h3>
<div class="outline-text-3" id="text-2-3">
<p>
The following map retrieves data about persons by querying
dbpedia's SPARQL endpoint. However, the output of the query does
not match the signature of the template. Change either the query
or the template so that the expansion works.
</p>

<div class="weblutra">
<input type="hidden" class="reset-value" data-name="inputFormat" value="bottr"/>
<div class="input">
<p>
<textarea cols="80" rows="21">
[] a ottr:InstanceMap ;
    ottr:template ex:Person ;
    ottr:query """
	PREFIX bif:<bif:> # virtuoso functions
	SELECT 
	    ?person ?givenname ?surname
	    (bif:datediff('year', xsd:dateTime(str(?born)), xsd:dateTime(str(?died))) AS ?age)
	WHERE { 
	    ?person foaf:givenName ?givenname ;
	       foaf:surname ?surname ;
	       dbp:deathDate ?died ;
	       dbp:birthDate ?born .
	    # ensure correct date format
	    FILTER(regex(str(?born), "[0-9]{4}-[0-9]{2}-[0-9]{2}"))
	    FILTER(regex(str(?died), "[0-9]{4}-[0-9]{2}-[0-9]{2}"))
	}
	LIMIT 20 
    """ ;
    ottr:source
	[ a ottr:SPARQLEndpointSource ;
	  ottr:sourceURL "http://dbpedia.org/sparql" ] .
</textarea>
</p>

</div>

<div class="library">
<p>
<textarea cols="80" rows="6">
ex:Person[ ?person, ?firstName, ?lastName, ?email ] :: {
  ottr:Triple (?person, rdf:type, foaf:Person ),
  ottr:Triple (?person, foaf:firstName, ?firstName ),
  ottr:Triple (?person, foaf:lastName, ?lastName ),
  ottr:Triple (?person, foaf:mbox, ?email )
} .
</textarea>
</p>

</div>

</div>
</div>
</div>


<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6"><span class="section-number-3">2.4</span> Exercise: Instantiating NamedPizza directly from the PizzaOntology</h3>
<div class="outline-text-3" id="text-2-4">
<p>
The following map instantiates the NamedPizza template by querying
the PizzaOntology. Note the use of <code>GROUP_CONCAT</code> to create a list
(represented as a list), and the use of <code>ottr:argumentMaps</code> to
split this list into a list argument.
</p>

<div class="weblutra">
<p>

</p>

<input type="hidden" class="reset-value" data-name="inputFormat" value="bottr"/>
<input type="hidden" class="reset-value" data-name="fetchMissing" value="true"/>
<div class="input">
<p>
<textarea cols="80" rows="45">
[] a ottr:InstanceMap ;
    ottr:template <http://tpl.ottr.xyz/pizza/0.1/NamedPizza> ;
    ottr:query """
PREFIX  p: <http://www.co-ode.org/ontologies/pizza/pizza.owl#>
SELECT 
  ?pizza 
  ?country 
  (GROUP_CONCAT(DISTINCT ?topping; SEPARATOR=";") AS ?toppingslist)
WHERE
  {
    ?pizza  
	rdfs:subClassOf  p:NamedPizza ;
	rdfs:subClassOf [
	    owl:allValuesFrom   [ owl:unionOf ?toppings ; rdf:type owl:Class ] ;
	    owl:onProperty      p:hasTopping ;
	    rdf:type            owl:Restriction ] ;
	rdfs:subClassOf [
	    owl:onProperty      p:hasTopping ;
	    owl:someValuesFrom  ?topping ;
	    rdf:type            owl:Restriction ] .

    ?toppings  (rdf:rest)*/rdf:first ?topping .

    OPTIONAL {
	?pizza  
	    rdfs:subClassOf [
		owl:hasValue        ?country ;
		owl:onProperty      p:hasCountryOfOrigin ;
		rdf:type            owl:Restriction ] .
    }                
  }
GROUP BY ?pizza ?country
LIMIT 1
 """ ;
    ottr:source
	[ a ottr:RDFFileSource ;
	  ottr:sourceURL 
	    "https://protege.stanford.edu/ontologies/pizza/pizza.owl" ] ;
    ottr:argumentMaps (
      []
      []
      [ ottr:type (rdf:List ottr:IRI); 
	ottr:translationSettings [ ottr:listSep ";"] 
      ]
   ) .
</textarea>
</p>

</div>

</div>
</div>
</div>
</div>


<div id="outline-container-orgheadline10" class="outline-2">
<h2 id="orgheadline10"><span class="section-number-2">3</span> Extracting data from CSV files and relational databases</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8"><span class="section-number-3">3.1</span> Exercise: Instantiate Person</h3>
<div class="outline-text-3" id="text-3-1">
<p>
The spreadsheet <a href="./files/04-bOTTR/persons.csv">persons.csv</a> contains data about people. In order
to instantiate the <code>ex:Person</code> template, we shall do the following
changes:
</p>

<ul class="org-ul">
<li>Use <code>CONCAT</code> function to create an IRI from the surname and use
this as 1. argument to the templat</li>
<li>Create a email address from the given name and surname and use
this as 4. argument to the template</li>
<li>Set the correct type of the argument maps.</li>
</ul>

<div class="weblutra">
<input type="hidden" class="reset-value" data-name="inputFormat" value="bottr"/>
<div class="input">
<p>
<textarea cols="80" rows="17">
[] a ottr:InstanceMap ;
    ottr:source [ a ottr:H2Source ] ;
    ottr:query """
      SELECT 
	  -- add something here
	"Given name",
	Surname, 
	  -- add something here
      FROM CSVREAD('@@THIS_DIR@@/persons.csv');
    """ ;
    ottr:template ex:Person ;
    ottr:argumentMaps (
      [ ]
      [ ]
      [ ] 
      [ ] 
    ) .
</textarea>
</p>

</div>

<div class="menu">CSV file<br/>
<input type="file" name="fileData">
</div>

<div class="library">
<p>
<textarea cols="80" rows="6">
ex:Person[ ?person, ?firstName, ?lastName, ?email ] :: {
  ottr:Triple (?person, rdf:type, foaf:Person ),
  ottr:Triple (?person, foaf:firstName, ?firstName ),
  ottr:Triple (?person, foaf:lastName, ?lastName ),
  ottr:Triple (?person, foaf:mbox, ?email )
} .
</textarea>
</p>

</div>

</div>
</div>
</div>

<div id="outline-container-orgheadline9" class="outline-3">
<h3 id="orgheadline9"><span class="section-number-3">3.2</span> Exercise: Instantiate Organization</h3>
<div class="outline-text-3" id="text-3-2">
<p>
The spreadsheet <a href="./files/04-bOTTR/organizations.csv">organizations.csv</a> contains data about
organisations and the map below is an attempt to instantiate the
<code>ex:Organization</code> template. However, to complete the map,
the 3. and 4. argumentmaps must have correct type, and
the 1. parameter of the template must accept missing values.
</p>

<div class="weblutra">
<input type="hidden" class="reset-value" data-name="inputFormat" value="bottr"/>
<div class="input">
<p>
<textarea cols="80" rows="17">
[] a ottr:InstanceMap ;
    ottr:source [ a ottr:H2Source ] ;
    ottr:query """
      SELECT 
	NULL, -- change the template to accept none
	Organization, 
	DATEDIFF(YEAR, Founded, TODAY()), 
	Homepage
      FROM CSVREAD('@@THIS_DIR@@/organizations.csv');
    """ ;
    ottr:template ex:Organization ;
    ottr:argumentMaps (
      [ ]
      [ ]
      [ ] # set correct type
      [ ] # set correct type
    ) .
</textarea>
</p>

</div>

<div class="menu">CSV file<br/>
<input type="file" name="fileData">
</div>

<div class="library">
<p>
<textarea cols="80" rows="10">
ex:Organization[ottr:IRI ?org, xsd:string ?name, xsd:int ?age, ottr:IRI ?url] :: {
    ex:Type(?org, foaf:Organization),
    ottr:Triple(?org, foaf:name, ?name),
    ottr:Triple(?org, foaf:age, ?age),
    ottr:Triple(?org, foaf:homepage, ?url)
} .

ex:Type[ottr:IRI ?individual, ottr:IRI ?type] :: {
  ottr:Triple(?individual, rdf:type, ?type)
} .
</textarea>
</p>

</div>

</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-2">
<h2 id="orgheadline11"><span class="section-number-2">4</span> References</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li><a id="orgtarget1"></a> Batch Instantiation of OTTR templates <a href="http://spec.ottr.xyz/bOTTR/0.1/">http://spec.ottr.xyz/bOTTR/0.1/</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-2">
<h2 id="orgheadline13"><span class="section-number-2">5</span> Appendix</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-orgheadline12" class="outline-3">
<h3 id="orgheadline12"><span class="section-number-3">5.1</span> WebLutra</h3>
<div class="outline-text-3" id="text-5-1">
<p>
The web application that drives the interactive examples in this
primer, called WebLutra, uses Lutra, the reference application for
OTTR. Both applications are open source and available at
<a href="http://gitlab.com/ottr/lutra/lutra">http://gitlab.com/ottr/lutra/lutra</a>. If you experience errors or have
suggestions for improvements, please take a look at existing issues
or file a new issue: <a href="http://gitlab.com/ottr/lutra/lutra/issues">http://gitlab.com/ottr/lutra/lutra/issues</a>
</p>
</div>
</div>
</div>
</div>
</body>
</html>
